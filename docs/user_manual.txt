Руководство пользователя

Данное руководство содержит инструкции которые позволят получить общее представление о программном обеспечении, произвести настройку и конфигурацию приложения, а также выполнить диагностику.

1. Назначение

Программное обеспечение spgate предназначено для опроса параметров приборов учета и предоставления данных параметров ПО верхнего уровня. Целевой платформой приложения является контроллер SMH4 с операционной системой семейства linux. Приложение поддерживает взаимодействие с приборами учета:
    - СПТ96?, СПГ76? по протоколу сп-бас
    - СПТ94?, СПГ74? по протоколу рс-бас
Протоколом взаимодействия с ПО верхнего уровня является modbus-tcp.


2. Конфигурация

Пример конфигурации приложения с подробными комментариями вы можете найти в файле:
spgate/cfg/default.ini

Требуется перезапуск приложения каждый раз после изменения конфигурации.


3. Запуск приложения

Приложение размещается на носителе контроллера SMH4 и запускается автоматически. Во время запуска приложения предусмотрена возможность передать некоторые параметры через аргументы:
    -c,--config FILENAME - параметр позволяет задать конфигурационный файл.
                           По умолчанию: ../cfg/default.ini
    -i,--cli_port NUMBER - позволяет задать порт консоли telnet.
                           По умолчанию: 0 - отключен


4. Диагностика

Приложение поддерживает функции логирования системных сообщений с целью выявления различных нештатных ситуаций. Возможно два режима работы функций логирования:
    - логирование сообщений в режиме CON запись в консоль(stdout)
    - логирование сообщений в режиме FILE запись в файл

Для выбора режима работы функций логирования следует воспользоваться переменной окружения:
    - задать переменную окружения перед запуском приложения(допустимы CON | FILE)
      $ export SG_LOGOUT=CON

Уровень логирования сообщений возможно задать несколькими способами:
    - через переменную окружения до запуска приложения(допустимы LD | LI | LW | LE)
      $ export SG_LOGLVL=LE
    - через консоль приложения установить требуемый уровень логирования, способ доступен при условии cli включен
      $ telnet 0 10000
      $ cli> log level=0
      $ cli> exit

Так же возможно указать директорию логирования для этого необходимо:
    - задать переменную окружения:
      $ export SG_LOGFOLDER=/tmp

По умолчанию функции логирования отлючены.

Для запуска приложения в режиме диагностики необходимо:
    - остановить сервис spgate
      $ service spgate stop
    - установить требуемый уровень логирования
      $ export SG_LOGLVL=LD
    - выполнить запуск приложения
      $ spgate --config /etc/spgate.ini
    - для завершения приложения нажмите ctrl-c
    - запустите сервис
      $ service spgate start

5. Функция контроля версии приложения

Функция позволить получить текущую версию приложения и контрольную сумму коммита:
    $ spgate --help

Результат выполения:
spgate 1.0.0
Build: master-88e3a0d
Usage: bin/spgate
Options:
	-h,--help		Show this help message
	-c,--config FILENAME	Define the configuration file
	-i,--cli_port NUMBER	Define command line interface port, 0 - disabled

Поле "Build" соответствует контрольной сумме коммита системы контроля версий git.

6. Установка приложения
    - скопировать файлы архива spgate.tar.gz в корневую систему контроллера
    - подключится по SSH контроллеру
    - изменить права следущих файлов:
      $ chmod 777 /etc/init.d/spgate
      $ chmod 777 /usr/local/bin/spgate
    - настроить автозапуск приложения командой
      $ update-rc.d spgate defaults
    - перезагрузить контроллер или выполнить запуск сервиса
      $ service spgate start
    - убедиться в том что приложение spgate выполняется в фоновом режиме
      $ ps -ef | grep spgate
    - после внесения изменений в файл конфигурации необходимо сохранить файл, а также перезагрузить контроллер, либо перезапустить сервис
      $ nano /etc/spgate.ini
      $ service spgate restart
